{"componentChunkName":"component---src-templates-blog-post-js","path":"/react/super-simple-react-scrollbar/","result":{"data":{"site":{"siteMetadata":{"title":"Jaehyeon's Dev Blog","author":"Jaehyeon Kim","siteUrl":"https://jaehyeon48.github.io","comment":{"disqusShortName":"","utterances":"jaehyeon48/blog-comments"}}},"markdownRemark":{"id":"9025f901-c3dd-5859-aa05-0aa7dd3883ae","excerpt":"개요 이전 프로젝트를 진행할 때 사이트 디자인을 참고하다가 업비트의 스크롤바가 신기했었습니다. 처음엔 ::-webkit-scrollbar…","html":"<h2 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"18\" height=\"18\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" viewBox=\"0 0 512 512\"><path fill=\"#05b166\" d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"></path></svg></a>개요</h2>\n<p>이전 프로젝트를 진행할 때 사이트 디자인을 참고하다가 <a href=\"https://upbit.com/home\" target=\"_blank\" rel=\"noreferrer noopener\">업비트</a>의 스크롤바가 신기했었습니다. 처음엔 <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/::-webkit-scrollbar\" target=\"_blank\" rel=\"noreferrer noopener\">::-webkit-scrollbar</a>로 커스터마이징한 줄 알았는데 알고보니 자체적으로 만든거였습니다..!</p>\n<figure>\n    <img src=\"https://cdn.jsdelivr.net/gh/jaehyeon48/jaehyeon48.github.io@master/assets/images/react/super-simple-react-scrollbar/upbit_scrollbar.gif\" alt=\"업비트 스크롤바\">\n</figure>\n<p>이전 프로젝트에선 <code class=\"language-text\">::-webkit-scrollbar</code> 기능을 이용하여 스크롤바를 커스터마이징 했지만, 스크롤바가 차지하는 공간으로 인해 레이아웃을 잡을 때 왼쪽/오른쪽 대칭을 맞추는게 꽤 번거롭다고 느꼈습니다. 이 때문에 다음 프로젝트에선 스크롤바를 따로 구현하여 업비트에서와 같은 스크롤바를 구현하고자 했습니다.</p>\n<h2 id=\"기초-작업\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EC%B4%88-%EC%9E%91%EC%97%85\" aria-label=\"기초 작업 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"18\" height=\"18\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" viewBox=\"0 0 512 512\"><path fill=\"#05b166\" d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"></path></svg></a>기초 작업</h2>\n<p>우선, 커스텀 스크롤바를 구현하기 위해 필요한 기초 계산들을 수행했습니다. 스크롤바는 주로 리스트, 테이블 등에서 사용되지 싶은데 리스트를 예로 들자면 바깥 컨테이너는 <code class=\"language-text\">&lt;ul></code>, 안쪽에는 여러 개의 <code class=\"language-text\">&lt;li></code>를 담고 있는 내부 컨테이너 <code class=\"language-text\">&lt;div></code> 등이 존재한다고 했을때 이를 그림으로 나타내면 아래와 같을겁니다:</p>\n<figure>\n    <img src=\"https://cdn.jsdelivr.net/gh/jaehyeon48/jaehyeon48.github.io@master/assets/images/react/super-simple-react-scrollbar/basic_layout.png\" alt=\"기본 레이아웃\">\n</figure>\n<p>일반적으로 내부 컨테이너(<code class=\"language-text\">&lt;div></code> 등)에는 여러 개의 <code class=\"language-text\">&lt;li></code>, <code class=\"language-text\">&lt;td></code> 등이 존재할 것이고, 외부 컨테이너는 보통 <code class=\"language-text\">&lt;ul></code>, <code class=\"language-text\">&lt;tbody></code> 등의 요소가 사용될 것입니다. 그리고 외부 컨테이너엔 <code class=\"language-text\">overflow: hidden scroll;</code>과 같은 css 속성을 먹여주겠죠?</p>\n<p>기본적인 레이아웃을 살펴봤으면 그 다음으로 스크롤바 막대 <code class=\"language-text\">thumb</code>의 높이를 구해줄 차례입니다. 비(ratio)를 이용하여 계산할 수 있을 듯 합니다:</p>\n<figure>\n    <img src=\"https://cdn.jsdelivr.net/gh/jaehyeon48/jaehyeon48.github.io@master/assets/images/react/super-simple-react-scrollbar/calculate_height_of_thumb.png\" alt=\"thumb 높이 구하기\">\n</figure>\n<p><del>~이때 두 번째 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>n</mi><mi>n</mi><mi>e</mi><mi>r</mi><mi>H</mi><mo>∗</mo><mi>t</mi><mi>h</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>H</mi><mo>=</mo><mi>o</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>r</mi><msup><mi>H</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">innerH * thumbH = outerH^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.08125em;\">H</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">h</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">b</span><span class=\"mord mathdefault\" style=\"margin-right:0.08125em;\">H</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.08125em;\">H</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> 식에서, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>n</mi><mi>n</mi><mi>e</mi><mi>r</mi><mi>H</mi><mo>≥</mo><mi>o</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>H</mi></mrow><annotation encoding=\"application/x-tex\">innerH ≥ outerH</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8193em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.08125em;\">H</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.08125em;\">H</span></span></span></span> 이므로 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi><mi>h</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>H</mi><mo>≤</mo><mi>o</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>H</mi></mrow><annotation encoding=\"application/x-tex\">thumbH ≤ outerH</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">h</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">b</span><span class=\"mord mathdefault\" style=\"margin-right:0.08125em;\">H</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\">u</span><span class=\"mord mathdefault\">t</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right:0.08125em;\">H</span></span></span></span>임을 유추할 수 있을 것 같습니다.</del>~</p>\n<p>제가 잘못생각했습니다! innerH가 outerH보다 작은 경우가 있을 수 있고 이때 thumbH의 height는 0이 되겠네요 😂</p>\n<br />\n<p><code class=\"language-text\">thumb</code>의 높이도 구했으면 마지막으로 <code class=\"language-text\">thumb</code>의 y좌표를 구해줄 차례입니다:</p>\n<figure>\n    <img src=\"https://cdn.jsdelivr.net/gh/jaehyeon48/jaehyeon48.github.io@master/assets/images/react/super-simple-react-scrollbar/calculate_y_of_thumb.png\" alt=\"thumb y좌표 구하기\">\n</figure>\n<p>위 그림에서와 같이 <code class=\"language-text\">thumb</code>를 위아래로 움직이기 위해 <code class=\"language-text\">transform: translateY()</code> css 속성을 적용할 예정입니다. 이를 위해 <code class=\"language-text\">translateY()</code> 함수에 들어갈 값을 알아내야겠죠!</p>\n<p>제가 생각한 로직은 다음과 같습니다. 일단 살펴보면 내부 컨테이너가 움직이는 y축 범위는 <code class=\"language-text\">0</code>(스크롤 제일 위) 부터 <code class=\"language-text\">innerH - outerH</code>(스크롤 제일 아래) 입니다. 하지만 이 범위를 그대로 <code class=\"language-text\">thumb</code>에 적용하면 아래 그림과 같이 됩니다:</p>\n<figure>\n    <img src=\"https://cdn.jsdelivr.net/gh/jaehyeon48/jaehyeon48.github.io@master/assets/images/react/super-simple-react-scrollbar/calculate_y_of_thumb_wrong.png\" alt=\"잘못된 thumb y좌표 구하기\">\n</figure>\n<p>즉, 스크롤을 제일 아래로 내렸을 때 스크롤은 외부 컨테이너의 최상단에 위치하게 됩니다. 하지만 우리가 원하는 것은 거기서 <code class=\"language-text\">outer - thumbH</code> 만큼 더 내려오는 것이죠!</p>\n<p>다시 말해 스크롤이 움직이는 y축 범위는 <code class=\"language-text\">0</code>(스크롤 제일 위) 부터 <code class=\"language-text\">innerH - outerH + outerH - thumbH = innerH - thumbH</code> (스크롤 제일 아래)가 된다고 할 수 있습니다.</p>\n<p>이에 착안하여 스크롤의 y축 범위를 구하는 방법은 아래 그림과 같습니다:</p>\n<figure>\n    <img src=\"https://cdn.jsdelivr.net/gh/jaehyeon48/jaehyeon48.github.io@master/assets/images/react/super-simple-react-scrollbar/calculate_height_of_thumb_final.png\" alt=\"thumb y좌표 구하기 최종\">\n</figure>\n<p>이제 모든 계산은 끝났으므로 이를 구현하기만 하면 됩니다!</p>\n<h2 id=\"구현1\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%841\" aria-label=\"구현1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"18\" height=\"18\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" viewBox=\"0 0 512 512\"><path fill=\"#05b166\" d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"></path></svg></a>구현1</h2>\n<p>여기까지 결정한 사항들을 바탕으로, 커스텀 훅 기반으로 구현한 데모 링크입니다: <a href=\"https://codesandbox.io/s/react-custom-scrollbar-demo-1-obn9b\" target=\"_blank\" rel=\"noreferrer noopener\">데모 링크</a></p>\n<h2 id=\"구현2\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%842\" aria-label=\"구현2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"18\" height=\"18\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" viewBox=\"0 0 512 512\"><path fill=\"#05b166\" d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"></path></svg></a>구현2</h2>\n<p>위 구현을 바탕으로, 특정 컨테이너가 아니라 앱의 스크롤을 바꾸는 <code class=\"language-text\">GlobalCustomScroll</code>을 구현해보았습니다. 글로벌 스크롤은 <code class=\"language-text\">root</code> 요소의 자식이 아니라 <code class=\"language-text\">body</code> 요소의 자식으로 렌더링하기 위해 <code class=\"language-text\">createPortal</code>을 사용했습니다: <a href=\"https://codesandbox.io/s/react-custom-scrollbar-demo-with-global-scroll-s1v0c\" target=\"_blank\" rel=\"noreferrer noopener\">데모 링크</a></p>\n<h2 id=\"남은-과제\" style=\"position:relative;\"><a href=\"#%EB%82%A8%EC%9D%80-%EA%B3%BC%EC%A0%9C\" aria-label=\"남은 과제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"18\" height=\"18\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" viewBox=\"0 0 512 512\"><path fill=\"#05b166\" d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"></path></svg></a>남은 과제</h2>\n<ul>\n<li>화면 resize시 그에 맞춰 스크롤바 thumb의 높이 다시 계산하기</li>\n<li><del>~스크롤바 <code class=\"language-text\">thumb</code>의 크기가 매우매우 작아지는 경우(즉, <code class=\"language-text\">outerH</code> 대비 <code class=\"language-text\">innerH</code>가 너무 커지는 경우)엔 어떻게 할것인가?</del>~</li>\n<li>실제 스크롤바처럼 마우스로 <code class=\"language-text\">thumb</code>를 잡고 움직일 수 있도록 구현하기</li>\n</ul>\n<h2 id=\"스크롤바-thumb의-크기가-매우-작아지는-케이스-처리\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%81%AC%EB%A1%A4%EB%B0%94-thumb%EC%9D%98-%ED%81%AC%EA%B8%B0%EA%B0%80-%EB%A7%A4%EC%9A%B0-%EC%9E%91%EC%95%84%EC%A7%80%EB%8A%94-%EC%BC%80%EC%9D%B4%EC%8A%A4-%EC%B2%98%EB%A6%AC\" aria-label=\"스크롤바 thumb의 크기가 매우 작아지는 케이스 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"18\" height=\"18\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" viewBox=\"0 0 512 512\"><path fill=\"#05b166\" d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"></path></svg></a>스크롤바 thumb의 크기가 매우 작아지는 케이스 처리</h2>\n<p>이번엔 스크롤바 thumb의 크기가 매우 작아지는 경우에 대해서 처리해보겠습니다. 기본적인 아이디어는, 계산된 thumb의 높이가 일정 수준 이하로 내려가면 미리 설정해둔 최소 thumb 높이를 설정하고 thumb의 y좌표값을 보정해주는 것입니다:</p>\n<figure>\n    <img src=\"https://cdn.jsdelivr.net/gh/jaehyeon48/jaehyeon48.github.io@master/assets/images/react/super-simple-react-scrollbar/revised_thumb_h_concept.png\" alt=\"최소 thumb 높이 조정\">\n</figure>\n<p>위 그림처럼 원래의 thumb을 original thumb, 조정된 thumb을 revised thumb이라고 하고, original thumb의 y좌표를 y, revised thumb의 y좌표를 y’라고 해보겠습니다. 이때, 원래의 thumb을 최소 크기로 조정한다면 원래의 thumb과 조정된 thumb 간에는 <code class=\"language-text\">ΔH</code> 만큼의 차이가 발생하게 됩니다. 저는 thumb 높이를 보정하는 것의 핵심은 바로 이 <code class=\"language-text\">ΔH</code> 만큼의 차이를 y’에 반영해주는 것이라 생각했습니다. 이를 통해 도출한 식은 다음과 같습니다:</p>\n<figure>\n    <img src=\"https://cdn.jsdelivr.net/gh/jaehyeon48/jaehyeon48.github.io@master/assets/images/react/super-simple-react-scrollbar/revised_thumb_h_calculation.png\" alt=\"최소 thumb 높이 조정 계산\">\n</figure>\n<p>이때 ymax값은 앞 섹션에서 구한 <code class=\"language-text\">innerH - thumbH</code>를 사용하면 되고, Δymax값은 (최소 thumb 높이 - 실제 thumb 높이)로 구할 수 있습니다.</p>\n<p>이것들을 반영하여 구현한 데모 링크입니다: <a href=\"https://codesandbox.io/s/react-scrollbar-revise-min-height-demo-q527h\" target=\"_blank\" rel=\"noreferrer noopener\">데모</a></p>\n<p>이때, 글로벌 스크롤의 경우 스크롤을 올리고 내릴때 중간 중간에 이상하게 움직이는 버그가 있습니다. useCustomScrollBar 로직에는 이 같은 버그가 없는 것 같은데 버그의 원인은 아직 모르겠습니다. 기능적으로는 정상적으로 동작하는것으로 보아 페인팅 과정에서 무슨 문제가 일어나는 것 같습니다..? (예시를 위해 thumb의 너비를 크게 했습니다):</p>\n<figure>\n    <img src=\"https://cdn.jsdelivr.net/gh/jaehyeon48/jaehyeon48.github.io@master/assets/images/react/super-simple-react-scrollbar/scrollbar_bug.gif\" alt=\"최소 thumb 높이 조정 계산\">\n</figure>\n<h2 id=\"20220228-업데이트\" style=\"position:relative;\"><a href=\"#20220228-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8\" aria-label=\"20220228 업데이트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" width=\"18\" height=\"18\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"link\" viewBox=\"0 0 512 512\"><path fill=\"#05b166\" d=\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"></path></svg></a>2022.02.28 업데이트</h2>\n<p>커스텀 스크롤바를 사용하다 보니, 리스트 아이템이 추가되거나 제거되는 경우에도 <code class=\"language-text\">thumb</code>의 높이와 <code class=\"language-text\">y</code> 좌표를 다시 계산해줘야 한다는 사실을 알게되어, 이를 반영해주었습니다.</p>\n<p>우선 <code class=\"language-text\">y</code> 좌표를 구하는 로직의 경우, <code class=\"language-text\">useEffect</code>를 이용하여 아래와 같이 스크롤바 훅을 사용하는 컴포넌트가 업데이트 될 때마다 <code class=\"language-text\">useEffect</code>를 실행해주어 <code class=\"language-text\">y</code> 좌표를 다시 계산하게 하였습니다:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> calculateThumbY <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>thumbRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>outerContainerRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>innerContainerRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> clientHeight<span class=\"token operator\">:</span> outerH <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> outerContainerRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> clientHeight<span class=\"token operator\">:</span> innerH <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> innerContainerRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> top<span class=\"token operator\">:</span> outerTop <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> outerContainerRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> top<span class=\"token operator\">:</span> innerTop <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> innerContainerRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> revisedThumbScrollY <span class=\"token operator\">=</span>\n  \toriginalThumbH<span class=\"token punctuation\">.</span>current <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n  \t  <span class=\"token operator\">?</span> <span class=\"token function\">calculateRevisedThumbH</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  \t  \t  outerTop<span class=\"token punctuation\">,</span>\n  \t  \t  innerTop<span class=\"token punctuation\">,</span>\n  \t  \t  outerH<span class=\"token punctuation\">,</span>\n  \t  \t  innerH<span class=\"token punctuation\">,</span>\n  \t  \t  outerContainerBorderWidth<span class=\"token punctuation\">,</span>\n  \t  \t  thumbH\n  \t    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  \t  <span class=\"token operator\">:</span> <span class=\"token function\">calculateRevisedThumbH</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  \t  \t  outerTop<span class=\"token punctuation\">,</span>\n  \t  \t  innerTop<span class=\"token punctuation\">,</span>\n  \t  \t  outerH<span class=\"token punctuation\">,</span>\n  \t  \t  innerH<span class=\"token punctuation\">,</span>\n  \t  \t  thumbH<span class=\"token operator\">:</span> originalThumbH<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">,</span>\n  \t  \t  outerContainerBorderWidth<span class=\"token punctuation\">,</span>\n  \t  \t  isRevisedToMinH<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  \t    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  thumbRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transform <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">translateY(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>revisedThumbScrollY<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>thumbH<span class=\"token punctuation\">,</span> innerContainerRef<span class=\"token punctuation\">,</span> outerContainerRef<span class=\"token punctuation\">,</span> outerContainerBorderWidth<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">calculateThumbY</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>calculateThumbY<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>그 다음, <code class=\"language-text\">thumb</code>의 높이를 구하는 이펙트의 의존성 배열을 제거하여 컴포넌트가 리렌더링될 때마다 높이를 다시 구하도록 하였습니다:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> intervalId<span class=\"token operator\">:</span> NodeJS<span class=\"token punctuation\">.</span>Timer<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">function</span> <span class=\"token function\">initThumbHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>outerContainerRef<span class=\"token punctuation\">.</span>current <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>innerContainerRef<span class=\"token punctuation\">.</span>current <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>thumbRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>intervalId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> clientHeight<span class=\"token operator\">:</span> outerH <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> outerContainerRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">;</span>\n\t  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> clientHeight<span class=\"token operator\">:</span> innerH <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> innerContainerRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">;</span>\n\t  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>innerH <span class=\"token operator\">&lt;=</span> outerH<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t  \t<span class=\"token function\">setThumbHeight</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t  \t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t  <span class=\"token punctuation\">}</span>\n\n\t  <span class=\"token keyword\">const</span> thumbHCandidate <span class=\"token operator\">=</span> outerH <span class=\"token operator\">**</span> <span class=\"token number\">2</span> <span class=\"token operator\">/</span> innerH<span class=\"token punctuation\">;</span>\n\t  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>thumbHCandidate <span class=\"token operator\">&lt;</span> <span class=\"token constant\">MIN_THUMB_H</span><span class=\"token punctuation\">)</span> originalThumbH<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> thumbHCandidate<span class=\"token punctuation\">;</span>\n\t  <span class=\"token function\">setThumbHeight</span><span class=\"token punctuation\">(</span>thumbHCandidate <span class=\"token operator\">&lt;</span> <span class=\"token constant\">MIN_THUMB_H</span> <span class=\"token operator\">?</span> <span class=\"token constant\">MIN_THUMB_H</span> <span class=\"token operator\">:</span> thumbHCandidate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>outerContainerRef<span class=\"token punctuation\">.</span>current <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>innerContainerRef<span class=\"token punctuation\">.</span>current <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>thumbRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    intervalId <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span>initThumbHeight<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token function\">initThumbHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre></div>\n<p>이때 예상되는 문제는, 아무래도 리스트 자체가 아니라 리스트의 부모가 리렌더링 되는 경우에도 (불필요하게?) 스크롤바 관련 계산이 다시 발생한다는 점인데, 이는 계산관련 로직을 외부로 위임하여 리스트가 업데이트 되는 경우에 해당 로직들을 외부에서 호출하도록 하면 최적화할 수 있을 듯 합니다.</p>\n<p>하지만 현재로선 일단 위 로직대로 사용하고 이후 성능상 저하가 많이 발생한다고 하면 그때가서 최적화할 수 있는 방안들을 살펴보려고 합니다.</p>","frontmatter":{"title":"초간단 React 커스텀 스크롤바 만들기","date":"February 08, 2022","category":"React"}}},"pageContext":{"slug":"/react/super-simple-react-scrollbar/","previous":{"fields":{"slug":"/react/super-simple-react-toast/"},"frontmatter":{"title":"초간단 React Toast 만들기"}},"next":{"fields":{"slug":"/web/how-browsers-work/"},"frontmatter":{"title":"브라우저의 동작 원리"}}}},"staticQueryHashes":[]}